## CloudFront ‚Äì Core Terms

CloudFront is AWS‚Äôs **global Content Delivery Network (CDN)**.

---

### Key Terminology

* **Origin**

  * The **source location** of your content
  * Where CloudFront fetches data from

* **Origin Types**

  * **S3 Origin** ‚Äì static content in S3
  * **Custom Origin** ‚Äì anything else (ALB, EC2, on-prem, any HTTP server)

* **Distribution**

  * The **configuration unit** of CloudFront
  * Contains origins, behaviors, caching rules, SSL settings

* **Edge Location**

  * Local **cache** close to users
  * Serves content with low latency

* **Regional Edge Cache**

  * Larger cache layer **between edge locations and origin**
  * Reduces origin load
  * Improves cache hit ratio

---

## TTL and Caching Behavior

---

### Why TTL Matters

* **More cache hits = lower origin load**
* Fewer requests to S3 / ALB / EC2

---

### Default TTL

* **Default TTL = 24 hours**
* Applies per **cache behavior**

---

### TTL Controls

You can configure:

* **Minimum TTL**
* **Maximum TTL**
* **Default TTL**

---

### Origin-Controlled Caching

CloudFront respects origin headers:

* **Cache-Control: max-age** (seconds)
* **Cache-Control: s-maxage** (seconds ‚Äì shared caches)
* **Expires** (date & time)

Sources:

* Custom origins (HTTP headers)
* S3 (object metadata)

---

## Cache Invalidation

---

### What It Does

* **Forces removal** of cached objects
* Performed on a **distribution**
* Applies to **all edge locations**
* **Takes time** to propagate

---

### Invalidation Paths

Examples:

* `/images/whiskers1.jpg`
* `/images/whiskers*`
* `/images/*`
* `/*`

---

### Better Practice (Exam Gold ‚≠ê)

* Use **versioned file names**

  * `whiskers1_v1.jpg`
  * `whiskers1_v2.jpg`
* Avoid frequent invalidations (cost + delay)

---

## AWS Certificate Manager (ACM) ‚Äì SSL Basics

---

### HTTP vs HTTPS

* **HTTP** ‚Äì plaintext, insecure
* **HTTPS** ‚Äì HTTP + **SSL/TLS**
* Data encrypted **in transit**

---

### Certificates

* Prove **identity**
* Based on a **chain of trust**
* Signed by a **trusted Certificate Authority (CA)**

---

### Public vs Private CA

* **Public CA**

  * Trusted by browsers by default
* **Private CA**

  * Applications must explicitly trust it
  * Used for internal systems

---

## ACM ‚Äì Certificate Lifecycle

---

### Certificate Sources

* **Generated by ACM**

  * Automatic renewal ‚úÖ
* **Imported into ACM**

  * You manage renewal ‚ùå

---

### Deployment Rules

* Certificates can be attached to:

  * CloudFront
  * ALB
* **NOT directly to EC2**

---

### Regional Scope (Very Important)

* ACM is a **regional service**
* Certificates **cannot leave the region**
* To use a cert:

  * It must exist in **the same region as the service**

---

### Special Case: CloudFront

* CloudFront is a **global service**
* It behaves as if it lives in **us-east-1**
* Therefore:

  * **CloudFront certificates must be in us-east-1**

üìå **Exam Trigger**
CloudFront + HTTPS + custom domain ‚Üí **ACM cert in us-east-1**

---

## CloudFront and SSL

---

### Default Domain

* Every distribution gets:

  * `xxxxxxxxxxxx.cloudfront.net`
* SSL supported automatically
* Uses `*.cloudfront.net` certificate

---

### Custom Domains (CNAMEs)

* Example: `cdn.example.com`
* Requires:

  * Domain ownership verification
  * Matching ACM certificate
* Certificate must be:

  * In **us-east-1**

---

### Viewer Protocol Policies

* HTTP only
* HTTP ‚Üí HTTPS
* HTTPS only

---

### Two SSL Connections

1. **Viewer ‚Üí CloudFront**
2. **CloudFront ‚Üí Origin**

Both require:

* Valid public certificates
* Proper trust chain

---

## CloudFront and SNI

---

### Historical Problem

* Older SSL required:

  * **One IP per SSL site**
* SSL handshake happens at **TCP layer**
* Host header appears later (Layer 7)

---

### SNI (Server Name Indication)

* TLS extension
* Allows **hostname** during SSL handshake
* Enables:

  * Multiple certificates
  * Multiple domains
  * **Shared IP**

---

### Result

* Many SSL sites on one IP
* Default CloudFront behavior uses SNI

---

### Legacy Browser Caveat

* Old browsers **don‚Äôt support SNI**
* CloudFront offers:

  * **Dedicated IP (extra cost)** if required

---

## CloudFront Origin Types ‚Äì Architecture

---

### S3 Origin

* Used for **static content**
* Integrates tightly with CloudFront
* Often paired with:

  * Origin Access Control (OAC)
  * Private buckets

---

### Custom Origin

* Used for:

  * ALB
  * EC2
  * On-prem servers
  * Any HTTP endpoint
* Supports:

  * Dynamic content
  * APIs

---

## High-Value Exam Triggers

* CDN + global users ‚Üí **CloudFront**
* Reduce origin load ‚Üí **TTL + caching**
* Force refresh ‚Üí **Invalidation**
* HTTPS on CloudFront ‚Üí **ACM in us-east-1**
* Custom domain + SSL ‚Üí **CNAME + cert**
* Legacy messaging? (No) ‚Üí **Dedicated IP only if SNI unsupported**

---

### One-Line Memory Hooks

* **Distribution** = CloudFront config
* **Edge** = cache near users
* **Regional Edge Cache** = bigger shared cache
* **Invalidation** = slow & costly ‚Üí version files
* **CloudFront SSL certs live in us-east-1**
* **SNI = many certs, one IP**
## Origin Access Identity (OAI)

OAI is a **CloudFront-specific identity** used to secure S3 origins.

---

### What an OAI Is

* An **OAI is an identity**
* It can be **associated with a CloudFront distribution**
* CloudFront **assumes (becomes)** that OAI when accessing S3
* The OAI is referenced inside **S3 bucket policies**

---

### Why OAI Exists

* Prevents **direct public access** to S3 objects
* Ensures content is served **only via CloudFront**

---

### Bucket Policy Pattern (Exam Gold ‚≠ê)

* **DENY** all access
* **ALLOW** access **only** to:

  * One or more specific OAIs

üìå Result:
S3 is private, CloudFront is the only entry point.

---

## Private Distributions (Behaviours)

CloudFront access control is configured at the **behavior level**.

---

### Access Types

* **Public**

  * Open access to objects
* **Private**

  * Requests require:

    * **Signed URL**
    * or **Signed Cookie**

---

### Behaviour Scope

* **Single behavior**

  * Entire distribution is PUBLIC or PRIVATE
* **Multiple behaviors**

  * Each behavior can be PUBLIC or PRIVATE

---

### Signing Configuration

* **Old model**

  * CloudFront key created by **root user**
  * Account added as **trusted signer**
* **New model**

  * Use **Trusted Key Groups** (recommended)

üìå **Exam tip**
Prefer **Trusted Key Groups** over legacy trusted signers.

---

## CloudFront Signed URLs vs Signed Cookies

---

### Signed URLs

* Grant access to **one specific object**
* Best when:

  * Client **does NOT support cookies**
  * Accessing a **single file**

üìå Historically required for RTMP distributions

---

### Signed Cookies

* Grant access to **multiple objects**
* Ideal for:

  * Groups of files
  * All files of a type (e.g., all images)
  * Preserving clean application URLs

---

### Decision Rule (Very High Value)

* **One object** ‚Üí Signed URL
* **Many objects** ‚Üí Signed Cookies
* **No cookie support** ‚Üí Signed URL

---

## Lambda@Edge ‚Äì Core Concepts

Lambda@Edge lets you run **lightweight Lambda functions at CloudFront edge locations**.

---

### What It Does

* Executes **closer to users**
* Modifies:

  * Requests
  * Responses
* Acts **between Viewer and Origin**

---

### Runtime & Environment

* Supports:

  * **Node.js**
  * **Python**
* Runs in:

  * **AWS public space**
  * ‚ùå Not in a VPC
* **Lambda Layers not supported**
* Has **different limits** than regional Lambda

---

## Lambda@Edge Use Cases

---

### Viewer Request (Before Cache Lookup)

* **A/B testing**
* Authentication checks
* URL rewrites
* Header inspection

---

### Origin Request (Cache Miss Only)

* **Migrate between S3 origins**
* Serve different objects based on:

  * Device type
  * Country / geography

---

### Execution Timing (Exam Favorite ‚≠ê)

* Viewer Request ‚Üí **Every request**
* Origin Request ‚Üí **Cache miss only**

---

## High-Value Exam Triggers

* Secure S3 behind CloudFront ‚Üí **OAI**
* Prevent direct S3 access ‚Üí **Bucket policy + OAI**
* Restrict CloudFront content ‚Üí **Signed URLs / Cookies**
* Per-file access ‚Üí **Signed URL**
* Group access ‚Üí **Signed Cookies**
* Modify requests globally ‚Üí **Lambda@Edge**
* A/B testing ‚Üí **Viewer Request**
* Origin switching ‚Üí **Origin Request**

---

### One-Line Memory Hooks

* **OAI** = CloudFront‚Äôs S3 identity
* **Private CF** = Signed URL or Cookie
* **Signed URL** = one object
* **Signed Cookie** = many objects
* **Lambda@Edge** = logic at the edge
* **Viewer vs Origin request** = before vs after cache
