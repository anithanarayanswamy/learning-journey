## Amazon S3 Encryption

### Amazon S3 Encryption Client (Client-Side Encryption)

- **Client-side encryption** means your data is encrypted locally before sending to S3.
  - This ensures your data is secure **in transit and at rest**.
- Using the **Amazon S3 Encryption Client**, AWS never sees the unencrypted object.
  - Even AWS cannot decrypt your data.
- AWS S3 receives already encrypted objects and simply stores them.

**Important (SAA-C03):**  
- Client-side encryption gives you **full control of encryption keys** — AWS never handles decryption.

---

## Server-Side Encryption (SSE)

- **Server-side encryption** encrypts objects **when they arrive** and decrypts them when accessed.
- S3 handles both encryption and decryption automatically.
- You access encrypted objects the same way you would unencrypted objects.
- S3 encryption does not impact the way you list or access your objects.

---

## Default Encryption in S3

- **All new S3 buckets** are automatically encrypted at rest.
- The default encryption type is **SSE-S3** (S3 Managed Keys).
- You can override default encryption by:
  - Specifying encryption on PUT requests
  - Changing the bucket’s default encryption settings

---

## Server-Side Encryption Types

- **SSE-S3:** Encryption managed by S3 (default)
- **SSE-KMS:** Uses AWS Key Management Service (KMS) for stronger control and audit
- **DSSE-KMS:** Dual-layer encryption using KMS
- **SSE-C:** Customer provides encryption keys

 
- SSE-KMS is commonly used in enterprise environments due to control and auditing.

---

## Temporary Security Credentials (AWS STS)

- Used to provide **short-lived credentials** generated by AWS STS.
- Temporary credentials expire automatically and are more secure.

### Characteristics

- Valid for a limited period — typically minutes to hours
- Not stored long-term
- Can be renewed if allowed
- Works globally, regardless of the region issued

 
- **IAM Roles use STS temporary credentials internally.**

---

## Why Use Temporary Credentials?

- No need to embed long-term credentials in apps
- Useful for:
  - Cross-account access
  - Identity federation
  - Delegation and role switching
- Expire automatically — no manual revocation

---

## AWS STS and Regional Endpoints

- AWS STS default global endpoint:
  - `https://sts.amazonaws.com`
- You can also call STS in regional endpoints
  - helps reduce latency
  - credentials still work globally

---

## Amazon GuardDuty Overview

**Amazon GuardDuty** — Threat detection service that automatically monitors:

- AWS CloudTrail logs
- VPC Flow Logs
- DNS logs
- Threat intelligence feeds

### Detection Capabilities

- Compromised credentials
- Data exfiltration patterns
- Unusual login activity
- Cryptomining
- Malware presence in instances or containers

 
- GuardDuty is *managed* and requires minimal maintenance.

---

## AWS VPC Fundamentals

### VPC Sizing

| VPC Size | Netmask | Subnet Size | Hosts/Subnet | Subnets per VPC | Total IPs |
|----------|---------|-------------|--------------|-----------------|-----------|
| Micro      | /24 | /27 | 27 | 8 | 216 |
| Small      | /21 | /24 | 251 | 8 | 2008 |
| Medium     | /19 | /22 | 1019 | 8 | 8152 |
| Large      | /18 | /21 | 2043 | 8 | 16344 |
| Extra Large| /16 | /20 | 4091 | 16 | 65456 |


- Understand how subnet size impacts host allocation.

---

## VPC CIDR Range

- A VPC must be between:
  - **/28** (smallest — 16 IPs)
  - **/16** (largest — 65,536 IPs)

---

## DNS in a VPC

- AWS Route 53 provides DNS services within a VPC
- DNS server IP:
  - **VPC base IP + 2**
- Configuration options:
  - `enableDnsHostnames`
    - Gives EC2 instances DNS hostnames
  - `enableDnsSupport`
    - Enables DNS resolution


- These are enabled by default in custom VPCs.

---

## Subnets

- A subnet is tied to a specific Availability Zone
- Must be a subset of the VPC CIDR
- Subnets cannot overlap

---

## AWS Reserved IPs (in Subnets)

AWS reserves the following for each subnet:

| Position | Reserved For |
|----------|--------------|
| +0 | Network address |
| +1 | VPC Router |
| +2 | Reserved for DNS |
| +3 | AWS future use |
| Last IP | Broadcast (Unavailable) |


- Always remember: **first 4 and last IP are reserved**.

---

## Quick Exam Checklist – Day 9 (SAA-C03)

| Topic | Key point |
|-------|-----------|
| **S3 Client-side encryption** | Encrypt before upload; AWS never sees plaintext; full key control. |
| **SSE** | Server-side; S3 encrypts/decrypts; default encryption on new buckets = SSE-S3. |
| **SSE types** | SSE-S3 (default), SSE-KMS, DSSE-KMS, SSE-C (customer keys). |
| **STS** | Short-lived credentials; used by roles, federation, cross-account; global. |
| **GuardDuty** | Threat detection; CloudTrail, VPC Flow, DNS; managed; minimal maintenance. |
| **VPC CIDR** | /28 (min) to /16 (max); subnets = subset of VPC; no overlap. |
| **Reserved IPs** | First 4 (network, router, DNS, future) + last (broadcast) per subnet. |
| **DNS in VPC** | enableDnsHostnames, enableDnsSupport; VPC base + 2 = DNS. |
| **Subnets** | One AZ per subnet; subset of VPC CIDR; cannot overlap. |

---

## Important Exam Points – Day 9

- **Client-side encryption** = you control keys; AWS never decrypts; **SSE** = S3 manages encryption at rest.
- **Default encryption**: All **new S3 buckets** encrypted at rest (SSE-S3 default).
- **STS** = temporary credentials; **IAM roles use STS** internally; regional endpoints reduce latency.
- **GuardDuty** = managed threat detection; uses CloudTrail, VPC Flow Logs, DNS; no agent.
- **VPC**: **/28 to /16**; **first 4 + last IP** reserved per subnet (router at +1, DNS at +2).
- **Subnets** cannot span AZs; must be subset of VPC CIDR; subnets cannot overlap.
